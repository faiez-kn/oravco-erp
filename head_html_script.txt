<script>
// Oravco ERP Ultra-Complete Branding Script
(function() {
    'use strict';
    
    const replacements = [
        { pattern: /ERPNext/gi, replacement: 'Oravco ERP' },
        { pattern: /ERP Next/gi, replacement: 'Oravco ERP' },
        { pattern: /ERP-Next/gi, replacement: 'Oravco ERP' },
        { pattern: /Frappe Framework/gi, replacement: 'Oravco ERP' },
        { pattern: /Powered by Frappe/gi, replacement: 'Powered by Oravco ERP' },
        { pattern: /Built on Frappe/gi, replacement: 'Built on Oravco ERP' }
    ];
    
    function replaceTextInNode(node) {
        if (node.nodeType === Node.TEXT_NODE && node.textContent) {
            replacements.forEach(function(r) {
                node.textContent = node.textContent.replace(r.pattern, r.replacement);
            });
        } else if (node.nodeType === Node.ELEMENT_NODE && node.tagName !== 'SCRIPT' && node.tagName !== 'STYLE' && node.tagName !== 'NOSCRIPT') {
            ['title', 'alt', 'placeholder', 'aria-label', 'data-label', 'data-title'].forEach(function(attr) {
                const val = node[attr] || node.getAttribute(attr);
                if (val) {
                    let newVal = val;
                    replacements.forEach(function(r) {
                        newVal = newVal.replace(r.pattern, r.replacement);
                    });
                    if (newVal !== val) {
                        if (node[attr]) {
                            node[attr] = newVal;
                        } else {
                            node.setAttribute(attr, newVal);
                        }
                    }
                }
            });
            Array.from(node.childNodes).forEach(replaceTextInNode);
        }
    }
    
    function applyBranding() {
        replaceTextInNode(document.body);
        if (document.title) {
            replacements.forEach(function(r) {
                document.title = document.title.replace(r.pattern, r.replacement);
            });
        }
        document.querySelectorAll('meta[property="og:title"], meta[name="title"]').forEach(function(meta) {
            if (meta.content) {
                replacements.forEach(function(r) {
                    meta.content = meta.content.replace(r.pattern, r.replacement);
                });
            }
        });
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', applyBranding);
    } else {
        applyBranding();
    }
    
    if (typeof MutationObserver !== 'undefined') {
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                    replaceTextInNode(node);
                });
                if (mutation.type === 'characterData') {
                    replaceTextInNode(mutation.target);
                }
            });
        });
        observer.observe(document.body, {
            childList: true,
            subtree: true,
            characterData: true,
            attributes: true,
            attributeFilter: ['title', 'alt', 'aria-label', 'data-label']
        });
    }
    
    if (typeof frappe !== 'undefined') {
        frappe.ready(function() {
            if (frappe.boot && frappe.boot.apps_info) {
                Object.keys(frappe.boot.apps_info).forEach(function(app) {
                    const appInfo = frappe.boot.apps_info[app];
                    if (appInfo && appInfo.app_title) {
                        replacements.forEach(function(r) {
                            appInfo.app_title = appInfo.app_title.replace(r.pattern, r.replacement);
                        });
                    }
                });
            }
            if (frappe.boot && frappe.boot.sysdefaults && frappe.boot.sysdefaults.app_name) {
                replacements.forEach(function(r) {
                    frappe.boot.sysdefaults.app_name = frappe.boot.sysdefaults.app_name.replace(r.pattern, r.replacement);
                });
            }
            setTimeout(function() {
                document.querySelectorAll('[data-label], .workspace-label, .sidebar-item-label, .app-title, .navbar-brand, h1, h2, h3, h4, h5, h6, .card-title, .page-title').forEach(function(el) {
                    if (el.textContent) {
                        replacements.forEach(function(r) {
                            el.textContent = el.textContent.replace(r.pattern, r.replacement);
                        });
                    }
                });
                document.querySelectorAll('[title], [data-original-title]').forEach(function(el) {
                    const title = el.getAttribute('title') || el.getAttribute('data-original-title');
                    if (title) {
                        let newTitle = title;
                        replacements.forEach(function(r) {
                            newTitle = newTitle.replace(r.pattern, r.replacement);
                        });
                        if (newTitle !== title) {
                            el.setAttribute('title', newTitle);
                            if (el.getAttribute('data-original-title')) {
                                el.setAttribute('data-original-title', newTitle);
                            }
                        }
                    }
                });
            }, 500);
            setInterval(function() {
                document.querySelectorAll('.sidebar-item, .workspace-card, .navbar-item, .workspace-label').forEach(function(el) {
                    if (el.textContent) {
                        replacements.forEach(function(r) {
                            if (r.pattern.test(el.textContent)) {
                                el.textContent = el.textContent.replace(r.pattern, r.replacement);
                            }
                        });
                    }
                });
            }, 2000);
        });
    }
    
    setInterval(function() {
        if (document.title) {
            replacements.forEach(function(r) {
                document.title = document.title.replace(r.pattern, r.replacement);
            });
        }
    }, 3000);
})();
</script>

